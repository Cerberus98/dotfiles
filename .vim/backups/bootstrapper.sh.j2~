{% if bootstrapper is defined -%}
#!/bin/bash

set -euo

while ! kubectl get -n kube-system pods 2>/dev/null | grep kube-dns | grep Running; do
    echo "Waiting for all containers to launch, sleeping"
    sleep 5
done
while ! kubectl get pods 2>/dev/null | grep pixiecore | grep Running; do
    echo "Waiting for all containers to launch, sleeping"
    sleep 5
done
while ! kubectl get pods 2>/dev/null | grep pixiecore-server | grep Running; do
    echo "Waiting for all containers to launch, sleeping"
    sleep 5
done
while ! kubectl get pods 2>/dev/null | grep httpd | grep Running; do
    echo "Waiting for all containers to launch, sleeping"
    sleep 5
done

IMAGE={{ bootstrapper.image }}
CONFIG_FILE={{ bootstrapper.config_file }}
VOLUME="${CONFIG_FILE}:${CONFIG_FILE}"

docker pull ${IMAGE}
docker run -v ${VOLUME} ${IMAGE}

systemctl stop bootstrapper.service
systemctl disable bootstrapper.service
{% endif %}
