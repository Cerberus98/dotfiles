version: '2'
services:
    web:
        build: .
        env_file: compose_envfile
        environment:
            - SQLALCHEMY_DATABASE_URI=mysql+mysqldb://database/tranquility_dev
            - SSH_KEY_DIR=/authorized_keys/
            - SQLALCHEMY_DATABASE_URI=mysql+
            - LISTEN_IP=0.0.0.0
        ports:
            - "8080:8080"
        volumes:
            - ./authorized_keys:/authorized_keys
            - .:/tranquility
        depends_on:
            - database
        command: dockerize -timeout 120s -wait tcp://database:3306 tranquility-dev
    database:
        image: percona
        volumes:
            - ./database_data:/var/lib/mysql
        environment:
            - MYSQL_ALLOW_EMPTY_PASSWORD=1
